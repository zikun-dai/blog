---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("posts");
const tags = new Map();

for (const post of posts) {
  for (const tag of post.data.tags ?? []) {
    const list = tags.get(tag) ?? [];
    list.push(post);
    tags.set(tag, list);
  }
}

const sortedTags = Array.from(tags.entries()).sort((a, b) =>
  a[0].localeCompare(b[0])
);
---

<BaseLayout title="Tags">
  <section class="post-list">
    {sortedTags.map(([tag, list]) => (
      <article class="card">
        <h2 class="post-title">
          <a href={`/tags/${encodeURIComponent(tag)}/`}>{tag}</a>
        </h2>
        <p class="post-meta">{list.length} posts</p>
      </article>
    ))}
  </section>
</BaseLayout>
